import{a as oe,b as te,c as E,d as k,e as R}from"./chunk-3Z66SLMN.js";var V=oe((ye,F)=>{"use strict";var C=Object.defineProperty,ne=Object.getOwnPropertyDescriptor,re=Object.getOwnPropertyNames,le=Object.prototype.hasOwnProperty,ie=(e,o)=>{for(var t in o)C(e,t,{get:o[t],enumerable:!0})},se=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of re(o))!le.call(e,n)&&n!==t&&C(e,n,{get:()=>o[n],enumerable:!(r=ne(o,n))||r.enumerable});return e},ae=e=>se(C({},"__esModule",{value:!0}),e),_={};ie(_,{BotOutcome:()=>ce});F.exports=ae(_);var ce={Victory:"victory",Defeat:"defeat",Draw:"draw",Error:"error",None:"none"}});var p=te(V());var I=(e=0)=>o=>`\x1B[${o+e}m`,$=(e=0)=>o=>`\x1B[${38+e};5;${o}m`,D=(e=0)=>(o,t,r)=>`\x1B[${38+e};2;${o};${t};${r}m`,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},G=Object.keys(s.modifier),S=Object.keys(s.color),N=Object.keys(s.bgColor),L=[...S,...N];function ue(){let e=new Map;for(let[o,t]of Object.entries(s)){for(let[r,n]of Object.entries(t))s[r]={open:`\x1B[${n[0]}m`,close:`\x1B[${n[1]}m`},t[r]=s[r],e.set(n[0],n[1]);Object.defineProperty(s,o,{value:t,enumerable:!1})}return Object.defineProperty(s,"codes",{value:e,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi=I(),s.color.ansi256=$(),s.color.ansi16m=D(),s.bgColor.ansi=I(10),s.bgColor.ansi256=$(10),s.bgColor.ansi16m=D(10),Object.defineProperties(s,{rgbToAnsi256:{value(o,t,r){return o===t&&t===r?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5)},enumerable:!1},hexToRgb:{value(o){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(o.toString(16));if(!t)return[0,0,0];let[r]=t;r.length===3&&(r=[...r].map(l=>l+l).join(""));let n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,n&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1},ansi256ToAnsi:{value(o){if(o<8)return 30+o;if(o<16)return 90+(o-8);let t,r,n;if(o>=232)t=((o-232)*10+8)/255,r=t,n=t;else{o-=16;let c=o%36;t=Math.floor(o/36)/5,r=Math.floor(c/6)/5,n=c%6/5}let l=Math.max(t,r,n)*2;if(l===0)return 30;let i=30+(Math.round(n)<<2|Math.round(r)<<1|Math.round(t));return l===2&&(i+=60),i},enumerable:!1},rgbToAnsi:{value:(o,t,r)=>s.ansi256ToAnsi(s.rgbToAnsi256(o,t,r)),enumerable:!1},hexToAnsi:{value:o=>s.ansi256ToAnsi(s.hexToAnsi256(o)),enumerable:!1}}),s}var be=ue(),b=be;var O=(()=>{if(navigator.userAgentData){let e=navigator.userAgentData.brands.find(({brand:o})=>o==="Chromium");if(e&&e.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),U=O!==0&&{level:O,hasBasic:!0,has256:O>=2,has16m:O>=3},pe={stdout:U,stderr:U},X=pe;function Y(e,o,t){let r=e.indexOf(o);if(r===-1)return e;let n=o.length,l=0,i="";do i+=e.slice(l,r)+o+t,l=r+n,r=e.indexOf(o,l);while(r!==-1);return i+=e.slice(l),i}function H(e,o,t,r){let n=0,l="";do{let i=e[r-1]==="\r";l+=e.slice(n,i?r-1:r)+o+(i?`\r
`:`
`)+t,n=r+1,r=e.indexOf(`
`,n)}while(r!==-1);return l+=e.slice(n),l}var{stdout:W,stderr:Z}=X,T=Symbol("GENERATOR"),g=Symbol("STYLER"),x=Symbol("IS_EMPTY"),K=["ansi","ansi","ansi256","ansi16m"],d=Object.create(null),fe=(e,o={})=>{if(o.level&&!(Number.isInteger(o.level)&&o.level>=0&&o.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let t=W?W.level:0;e.level=o.level===void 0?t:o.level},B=class{constructor(o){return J(o)}},J=e=>{let o=(...t)=>t.join(" ");return fe(o,e),Object.setPrototypeOf(o,y.prototype),o};function y(e){return J(e)}Object.setPrototypeOf(y.prototype,Function.prototype);for(let[e,o]of Object.entries(b))d[e]={get(){let t=w(this,j(o.open,o.close,this[g]),this[x]);return Object.defineProperty(this,e,{value:t}),t}};d.visible={get(){let e=w(this,this[g],!0);return Object.defineProperty(this,"visible",{value:e}),e}};var P=(e,o,t,...r)=>e==="rgb"?o==="ansi16m"?b[t].ansi16m(...r):o==="ansi256"?b[t].ansi256(b.rgbToAnsi256(...r)):b[t].ansi(b.rgbToAnsi(...r)):e==="hex"?P("rgb",o,t,...b.hexToRgb(...r)):b[t][e](...r),he=["rgb","hex","ansi256"];for(let e of he){d[e]={get(){let{level:t}=this;return function(...r){let n=j(P(e,K[t],"color",...r),b.color.close,this[g]);return w(this,n,this[x])}}};let o="bg"+e[0].toUpperCase()+e.slice(1);d[o]={get(){let{level:t}=this;return function(...r){let n=j(P(e,K[t],"bgColor",...r),b.bgColor.close,this[g]);return w(this,n,this[x])}}}}var ge=Object.defineProperties(()=>{},{...d,level:{enumerable:!0,get(){return this[T].level},set(e){this[T].level=e}}}),j=(e,o,t)=>{let r,n;return t===void 0?(r=e,n=o):(r=t.openAll+e,n=o+t.closeAll),{open:e,close:o,openAll:r,closeAll:n,parent:t}},w=(e,o,t)=>{let r=(...n)=>de(r,n.length===1?""+n[0]:n.join(" "));return Object.setPrototypeOf(r,ge),r[T]=e,r[g]=o,r[x]=t,r},de=(e,o)=>{if(e.level<=0||!o)return e[x]?"":o;let t=e[g];if(t===void 0)return o;let{openAll:r,closeAll:n}=t;if(o.includes("\x1B"))for(;t!==void 0;)o=Y(o,t.close,t.open),t=t.parent;let l=o.indexOf(`
`);return l!==-1&&(o=H(o,n,r,l)),r+o+n};Object.defineProperties(y.prototype,d);var Ae=y(),Ce=y({level:Z?Z.level:0});var m=new B({level:3});Zilch.play=async function*(e){let o=e.config.serveTo==="random"?Math.random()>.5?"west":"east":e.config.serveTo,t={hitX:-20,hitZ:1.5,landX:20},r=.3;o==="west"&&(r+=Math.PI,t.hitX*=-1,t.landX*=-1);let n={index:0,annotations:[],lastBall:null,ball:{speed:10,intercept:null,hit:t,angle:r,position:{x:0,y:0}},p1:{lastMove:"none",wins:0,position:{x:-34,y:-10}},p2:{lastMove:"none",wins:0,position:{x:34,y:10}}},l=[],i=[];for(;;){n.index++;let c=M=>A=>(A instanceof Error||M.writeln(m.dim(`\u2937 ${A}`)),A);e.bots[0].writeln(m.dim("Start move")),e.bots[1].writeln(m.dim("Start move"));let[u,a]=await Promise.all([e.bots[0].move(ee(n,"p1")).then(Q).then(c(e.bots[0])),e.bots[1].move(ee(n,"p2")).then(Q).then(c(e.bots[1]))]);if(u instanceof Error){e.bots[0].writeln(m.red(`Unable to parse move. ${u.message}`)),yield{outcome:[p.BotOutcome.Error,p.BotOutcome.None],state:n};continue}if(a instanceof Error){e.bots[1].writeln(m.red(`Unable to parse move. ${a.message}`)),yield{outcome:[p.BotOutcome.None,p.BotOutcome.Error],state:n};continue}n.annotations=[];let f=q("p1",n.p1.position,u,l),h=q("p2",n.p2.position,a,i);xe(n,f,h),n.p1.position.x+=f.x,n.p1.position.y+=f.y,n.p2.position.x+=h.x,n.p2.position.y+=h.y,l.unshift(u),i.unshift(a),l.length>4&&l.pop(),i.length>4&&i.pop();let v=8;Math.cos(n.ball.angle)>0&&n.ball.position.x>36&&n.ball.position.x>n.p2.position.x+v&&(yield{state:n,outcome:[p.BotOutcome.Victory,p.BotOutcome.Defeat]}),Math.cos(n.ball.angle)<0&&n.ball.position.x<-36&&n.ball.position.x<n.p1.position.x-v&&(yield{state:n,outcome:[p.BotOutcome.Defeat,p.BotOutcome.Victory]}),yield{state:n,outcome:null}}};function xe(e,o,t){if(z(e,o,"p1")||z(e,t,"p2"))return;let r=Math.cos(e.ball.angle)*e.ball.speed,n=Math.sin(e.ball.angle)*e.ball.speed;e.ball.intercept=null,e.ball.position.x+=r,e.ball.position.y+=n}function z(e,o,t){let r=Math.cos(e.ball.angle)*e.ball.speed,n=Math.sin(e.ball.angle)*e.ball.speed;if(t==="p1"&&r>0||t==="p2"&&r<0)return!1;let l=5.5,i=R({radius:.8,x:e.ball.position.x,y:e.ball.position.y,xVelocity:Math.cos(e.ball.angle)*e.ball.speed,yVelocity:Math.sin(e.ball.angle)*e.ball.speed},{p1:{x:e[t].position.x,y:e[t].position.y-l/2},p2:{x:e[t].position.x,y:e[t].position.y+l/2},xVelocity:o.x,yVelocity:o.y});if(!i)return!1;let c=t==="p1"&&o.x>0||t==="p2"&&o.x<0,u=Math.abs(e[t].position.x)<24,a=10;u&&(a*=1.4),c&&(a*=1.4);let f={x:(Math.random()*11.8+11.8)*(t==="p1"?1:-1),y:Math.random()*a-a/2},h=e.ball.position.x+r*i.time,v=k(h,e.ball.hit)*E;e.lastBall=JSON.parse(JSON.stringify(e.ball)),e.ball.hit={hitX:h,hitZ:v,landX:f.x},e.ball.intercept={x:h,y:e.ball.position.y+n*i.time},o.x<0&&t==="p2"||o.x>0&&t==="p1"?e.ball.speed*=1.1:e.ball.speed*=1.02;let M=e.ball.speed*(1-i.time);return e.ball.angle=Math.atan2(f.y-e.ball.position.y,f.x-e.ball.position.x),e.ball.position={x:e.ball.position.x+Math.cos(e.ball.angle)*M,y:e.ball.position.y+Math.sin(e.ball.angle)*M},!0}function q(e,o,t,r){if(t==="none")return{x:0,y:0};let n=0;for(let a=0;a<Math.min(4,r.length)&&r[a]===t;a++)n++;let l=1.5+2*n,i={x:t==="north"||t==="south"?0:t==="west"?-l:l,y:t==="east"||t==="west"?0:t==="north"?l:-l},c=23.6,u=42;return e==="p1"?o.x+i.x>-c?i.x=-c-o.x:o.x+i.x<-u&&(i.x=-u-o.x):o.x+i.x<c?i.x=c-o.x:o.x+i.x>u&&(i.x=u-o.x),i}function Q(e){return e==="north"||e==="south"||e==="east"||e==="west"||e==="none"?e:new Error(`Move invalid: "${e}"
Expected "north" "south" "east" "west" or "none"`)}function ee(e,o){return[e[o].position.x,e[o].position.y,e.ball.position.x,e.ball.position.y].join(",")}
//# sourceMappingURL=play.js.map
