import{a as oe,b as te,c as E,d as k,e as R}from"./chunk-YT6EPVVD.js";var V=oe((me,F)=>{"use strict";var C=Object.defineProperty,ne=Object.getOwnPropertyDescriptor,re=Object.getOwnPropertyNames,le=Object.prototype.hasOwnProperty,ie=(e,o)=>{for(var t in o)C(e,t,{get:o[t],enumerable:!0})},se=(e,o,t,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of re(o))!le.call(e,r)&&r!==t&&C(e,r,{get:()=>o[r],enumerable:!(n=ne(o,r))||n.enumerable});return e},ae=e=>se(C({},"__esModule",{value:!0}),e),_={};ie(_,{BotOutcome:()=>ce});F.exports=ae(_);var ce={Victory:"victory",Defeat:"defeat",Draw:"draw",Error:"error",None:"none"}});var h=te(V());var I=(e=0)=>o=>`\x1B[${o+e}m`,$=(e=0)=>o=>`\x1B[${38+e};5;${o}m`,D=(e=0)=>(o,t,n)=>`\x1B[${38+e};2;${o};${t};${n}m`,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},G=Object.keys(s.modifier),S=Object.keys(s.color),N=Object.keys(s.bgColor),L=[...S,...N];function ue(){let e=new Map;for(let[o,t]of Object.entries(s)){for(let[n,r]of Object.entries(t))s[n]={open:`\x1B[${r[0]}m`,close:`\x1B[${r[1]}m`},t[n]=s[n],e.set(r[0],r[1]);Object.defineProperty(s,o,{value:t,enumerable:!1})}return Object.defineProperty(s,"codes",{value:e,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi=I(),s.color.ansi256=$(),s.color.ansi16m=D(),s.bgColor.ansi=I(10),s.bgColor.ansi256=$(10),s.bgColor.ansi16m=D(10),Object.defineProperties(s,{rgbToAnsi256:{value(o,t,n){return o===t&&t===n?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)},enumerable:!1},hexToRgb:{value(o){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(o.toString(16));if(!t)return[0,0,0];let[n]=t;n.length===3&&(n=[...n].map(l=>l+l).join(""));let r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,r&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1},ansi256ToAnsi:{value(o){if(o<8)return 30+o;if(o<16)return 90+(o-8);let t,n,r;if(o>=232)t=((o-232)*10+8)/255,n=t,r=t;else{o-=16;let u=o%36;t=Math.floor(o/36)/5,n=Math.floor(u/6)/5,r=u%6/5}let l=Math.max(t,n,r)*2;if(l===0)return 30;let i=30+(Math.round(r)<<2|Math.round(n)<<1|Math.round(t));return l===2&&(i+=60),i},enumerable:!1},rgbToAnsi:{value:(o,t,n)=>s.ansi256ToAnsi(s.rgbToAnsi256(o,t,n)),enumerable:!1},hexToAnsi:{value:o=>s.ansi256ToAnsi(s.hexToAnsi256(o)),enumerable:!1}}),s}var pe=ue(),b=pe;var O=(()=>{if(navigator.userAgentData){let e=navigator.userAgentData.brands.find(({brand:o})=>o==="Chromium");if(e&&e.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),X=O!==0&&{level:O,hasBasic:!0,has256:O>=2,has16m:O>=3},be={stdout:X,stderr:X},U=be;function H(e,o,t){let n=e.indexOf(o);if(n===-1)return e;let r=o.length,l=0,i="";do i+=e.slice(l,n)+o+t,l=n+r,n=e.indexOf(o,l);while(n!==-1);return i+=e.slice(l),i}function Y(e,o,t,n){let r=0,l="";do{let i=e[n-1]==="\r";l+=e.slice(r,i?n-1:n)+o+(i?`\r
`:`
`)+t,r=n+1,n=e.indexOf(`
`,r)}while(n!==-1);return l+=e.slice(r),l}var{stdout:W,stderr:Z}=U,P=Symbol("GENERATOR"),d=Symbol("STYLER"),m=Symbol("IS_EMPTY"),K=["ansi","ansi","ansi256","ansi16m"],g=Object.create(null),fe=(e,o={})=>{if(o.level&&!(Number.isInteger(o.level)&&o.level>=0&&o.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let t=W?W.level:0;e.level=o.level===void 0?t:o.level},B=class{constructor(o){return J(o)}},J=e=>{let o=(...t)=>t.join(" ");return fe(o,e),Object.setPrototypeOf(o,v.prototype),o};function v(e){return J(e)}Object.setPrototypeOf(v.prototype,Function.prototype);for(let[e,o]of Object.entries(b))g[e]={get(){let t=w(this,j(o.open,o.close,this[d]),this[m]);return Object.defineProperty(this,e,{value:t}),t}};g.visible={get(){let e=w(this,this[d],!0);return Object.defineProperty(this,"visible",{value:e}),e}};var T=(e,o,t,...n)=>e==="rgb"?o==="ansi16m"?b[t].ansi16m(...n):o==="ansi256"?b[t].ansi256(b.rgbToAnsi256(...n)):b[t].ansi(b.rgbToAnsi(...n)):e==="hex"?T("rgb",o,t,...b.hexToRgb(...n)):b[t][e](...n),he=["rgb","hex","ansi256"];for(let e of he){g[e]={get(){let{level:t}=this;return function(...n){let r=j(T(e,K[t],"color",...n),b.color.close,this[d]);return w(this,r,this[m])}}};let o="bg"+e[0].toUpperCase()+e.slice(1);g[o]={get(){let{level:t}=this;return function(...n){let r=j(T(e,K[t],"bgColor",...n),b.bgColor.close,this[d]);return w(this,r,this[m])}}}}var de=Object.defineProperties(()=>{},{...g,level:{enumerable:!0,get(){return this[P].level},set(e){this[P].level=e}}}),j=(e,o,t)=>{let n,r;return t===void 0?(n=e,r=o):(n=t.openAll+e,r=o+t.closeAll),{open:e,close:o,openAll:n,closeAll:r,parent:t}},w=(e,o,t)=>{let n=(...r)=>ge(n,r.length===1?""+r[0]:r.join(" "));return Object.setPrototypeOf(n,de),n[P]=e,n[d]=o,n[m]=t,n},ge=(e,o)=>{if(e.level<=0||!o)return e[m]?"":o;let t=e[d];if(t===void 0)return o;let{openAll:n,closeAll:r}=t;if(o.includes("\x1B"))for(;t!==void 0;)o=H(o,t.close,t.open),t=t.parent;let l=o.indexOf(`
`);return l!==-1&&(o=Y(o,r,n,l)),n+o+r};Object.defineProperties(v.prototype,g);var Ce=v(),Se=v({level:Z?Z.level:0});var M=new B({level:3});Zilch.play=async function*(e){let o=e.config.serveTo==="random"?Math.random()>.5?"east":"west":e.config.serveTo,t={hitX:-20,hitZ:1.5,landX:20},n=.3;o==="east"&&(n+=Math.PI,t.hitX*=-1,t.landX*=-1);let r={index:0,annotations:[],lastBall:null,ball:{speed:8,intercept:null,hit:t,angle:n,position:{x:0,y:0}},p1:{lastMove:"none",wins:0,position:{x:-34,y:-10}},p2:{lastMove:"none",wins:0,position:{x:34,y:10}}},l=[],i=[];for(;;){let u=xe(r);r.index++;let f=ee=>A=>(A instanceof Error||ee.writeln(M.dim(`\u2937 ${A}`)),A);e.bots[0].writeln(M.dim("Start move")),e.bots[1].writeln(M.dim("Start move"));let[a,c]=await Promise.all([e.bots[0].move(u).then(Q).then(f(e.bots[0])),e.bots[1].move(u).then(Q).then(f(e.bots[1]))]);if(a instanceof Error){e.bots[0].writeln(M.red(`Unable to parse move. ${a.message}`)),yield{outcome:[h.BotOutcome.Error,h.BotOutcome.None],state:r};continue}if(c instanceof Error){e.bots[1].writeln(M.red(`Unable to parse move. ${c.message}`)),yield{outcome:[h.BotOutcome.None,h.BotOutcome.Error],state:r};continue}r.annotations=[];let p=q("p1",r.p1.position,a,l),y=q("p2",r.p2.position,c,i);ye(r,p,y),r.p1.position.x+=p.x,r.p1.position.y+=p.y,r.p2.position.x+=y.x,r.p2.position.y+=y.y,l.unshift(a),i.unshift(c),l.length>4&&l.pop(),i.length>4&&i.pop();let x=8;Math.cos(r.ball.angle)>0&&r.ball.position.x>36&&r.ball.position.x>r.p2.position.x+x&&(yield{state:r,outcome:[h.BotOutcome.Victory,h.BotOutcome.Defeat]}),Math.cos(r.ball.angle)<0&&r.ball.position.x<-36&&r.ball.position.x<r.p1.position.x-x&&(yield{state:r,outcome:[h.BotOutcome.Defeat,h.BotOutcome.Victory]}),yield{state:r,outcome:null}}};function ye(e,o,t){if(z(e,o,"p1")||z(e,t,"p2"))return;let n=Math.cos(e.ball.angle)*e.ball.speed,r=Math.sin(e.ball.angle)*e.ball.speed;e.ball.intercept=null,e.ball.position.x+=n,e.ball.position.y+=r}function z(e,o,t){let n=Math.cos(e.ball.angle)*e.ball.speed,r=Math.sin(e.ball.angle)*e.ball.speed;if(t==="p1"&&n>0||t==="p2"&&n<0)return!1;let l=5.5,i=R({radius:.8,x:e.ball.position.x,y:e.ball.position.y,xVelocity:Math.cos(e.ball.angle)*e.ball.speed,yVelocity:Math.sin(e.ball.angle)*e.ball.speed},{p1:{x:e[t].position.x,y:e[t].position.y-l/2},p2:{x:e[t].position.x,y:e[t].position.y+l/2},xVelocity:o.x,yVelocity:o.y});if(!i)return!1;let u=t==="p1"&&o.x>0||t==="p2"&&o.x<0,f=Math.abs(e[t].position.x)<20,a=10;f&&(a*=1.5),u&&(a*=1.5);let c={x:(Math.random()*9+10)*(t==="p1"?1:-1),y:Math.random()*a-a/2},p=e.ball.position.x+n*i.time,y=k(p,e.ball.hit)*E;e.lastBall=JSON.parse(JSON.stringify(e.ball)),e.ball.hit={hitX:p,hitZ:y,landX:c.x},e.ball.intercept={x:p,y:e.ball.position.y+r*i.time},o.x<0&&t==="p2"||o.x>0&&t==="p1"?e.ball.speed*=1.05:e.ball.speed>10?e.ball.speed*=.98:e.ball.speed*=1.01,e.ball.speed>12&&(e.ball.speed=12);let x=e.ball.speed*(1-i.time);return e.ball.angle=Math.atan2(c.y-e.ball.position.y,c.x-e.ball.position.x),e.ball.position={x:e.ball.position.x+Math.cos(e.ball.angle)*x,y:e.ball.position.y+Math.sin(e.ball.angle)*x},!0}function q(e,o,t,n){if(t==="none")return{x:0,y:0};let r=0;for(let p=0;p<Math.min(4,n.length)&&n[p]===t;p++)r++;let l=1.5+2*r,i={x:t==="north"||t==="south"?0:t==="east"?-l:l,y:t==="east"||t==="west"?0:t==="north"?l:-l},u=i.x+o.x,f=6,a=45,c=!1;return e==="p1"?u>-f?(c=!0,i.x=-f-o.x):u<-a&&(c=!0,i.x=-a-o.x):u<f?(c=!0,i.x=f-o.x):u>a&&(c=!0,i.x=a-o.x),c&&n.splice(0,n.length),i}function Q(e){return e==="north"||e==="south"||e==="east"||e==="west"||e==="none"?e:new Error(`Move invalid: "${e}"
Expected "north" "south" "east" "west" or "none"`)}function xe(e){return[e.p1.position.x,e.p1.position.y,e.p2.position.x,e.p2.position.y,e.ball.position.x,e.ball.position.y].join(",")}
//# sourceMappingURL=play.js.map
