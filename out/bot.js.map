{
  "version": 3,
  "sources": ["../../src/bot.ts"],
  "sourcesContent": ["import type { StartBotParams } from \"zilch-game-engine\";\nimport { Move } from \"./play\";\n\nZilch.Bot = class Bot {\n  params: StartBotParams;\n\n  lastPaddleY: number = 0;\n  lastBallX: number = 0;\n  lastBallY: number = 0;\n  ballHitCount: number = 0;\n  lastBallComingTowardPaddle = false;\n  moveTowardNet = false;\n\n  constructor(params: StartBotParams) {\n    this.params = params;\n  }\n\n  static start(params: StartBotParams) {\n    return new Bot(params);\n  }\n\n  move(payload: string) {\n    const state = parsePayload(payload);\n    const isP1 = this.params.botIndex === 0;\n    const player = isP1 ? state.p1 : state.p2;\n\n    const ballVelocity = {\n      x: state.ball.x - this.lastBallX,\n      y: state.ball.y - this.lastBallY,\n    };\n\n    const ballComingTowardsPaddle = isP1\n      ? ballVelocity.x < 0\n      : ballVelocity.x > 0;\n\n    if (!ballComingTowardsPaddle && this.lastBallComingTowardPaddle) {\n      this.ballHitCount++;\n    }\n\n    let move = \"none\";\n\n    if (\n      (this.params.type === \"practice\" && this.ballHitCount > 0) ||\n      (this.params.type === \"boss-easy\" && this.ballHitCount > 2) ||\n      (this.params.type === \"boss-medium\" && this.ballHitCount > 14)\n    ) {\n      if (this.params.type === \"practice\" && Math.random() < 0.5) {\n        const moves = [\"north\", \"south\", \"east\", \"west\", \"none\"];\n        move = moves[Math.floor(Math.random() * moves.length)];\n      } else if (ballComingTowardsPaddle) {\n        if (Math.abs(state.ball.y - player.y) < 1) {\n          move = \"none\";\n        } else if (state.ball.y < player.y) {\n          move = \"south\";\n        } else if (state.ball.y > player.y) {\n          move = \"north\";\n        } else {\n          move = \"none\";\n        }\n      } else {\n        move = \"none\";\n      }\n    } else if (ballComingTowardsPaddle) {\n      const m = ballVelocity.x === 0 ? 0 : -ballVelocity.y / ballVelocity.x;\n      const b = state.ball.x * m + state.ball.y;\n      const yIntercept = -m * player.x + b;\n\n      this.moveTowardNet = Math.random() > 0.5;\n\n      if (Math.abs(yIntercept - player.y) < 1.5) {\n        move = \"none\";\n      } else if (yIntercept < player.y) {\n        move = \"south\";\n      } else if (yIntercept > player.y) {\n        move = \"north\";\n      } else {\n        move = \"none\";\n      }\n    } else {\n      if (player.y > 1) {\n        move = \"south\";\n      } else if (player.y < -1) {\n        move = \"north\";\n      } else if (\n        this.params.type !== \"boss-easy\" &&\n        !this.moveTowardNet &&\n        Math.abs(player.x) < 38\n      ) {\n        move = isP1 ? \"east\" : \"west\";\n      } else if (\n        this.params.type !== \"boss-easy\" &&\n        this.moveTowardNet &&\n        Math.abs(player.x) > 20\n      ) {\n        move = isP1 ? \"west\" : \"east\";\n      } else {\n        move = \"none\";\n      }\n    }\n\n    this.lastBallComingTowardPaddle = ballComingTowardsPaddle;\n    this.lastBallX = state.ball.x;\n    this.lastBallY = state.ball.y;\n    this.lastPaddleY = player.y;\n\n    return move;\n  }\n\n  end(payload: string) {}\n};\n\nfunction parsePayload(payload: string) {\n  const parts = payload.split(\",\");\n\n  if (parts.length !== 6) {\n    throw new Error(\"Unexpected payload\");\n  }\n\n  const [p1x, p1y, p2x, p2y, ballX, ballY] = parts.map((value) => {\n    const num = parseFloat(value);\n\n    if (isNaN(num)) {\n      throw new Error(\"Unexpected payload\");\n    }\n\n    return num;\n  });\n\n  return {\n    p1: {\n      x: p1x,\n      y: p1y,\n    },\n    p2: {\n      x: p2x,\n      y: p2y,\n    },\n    ball: {\n      x: ballX,\n      y: ballY,\n    },\n  };\n}\n"],
  "mappings": "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",
  "names": ["Bot", "params", "payload", "state", "parsePayload", "isP1", "player", "ballVelocity", "ballComingTowardsPaddle", "move", "moves", "m", "b", "yIntercept", "parts", "p1x", "p1y", "p2x", "p2y", "ballX", "ballY", "value", "num"]
}
